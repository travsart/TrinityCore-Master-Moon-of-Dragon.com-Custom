# WoW 11.2 (The War Within) Resource System Analysis

## Executive Summary
This document provides a comprehensive analysis of all 13 class resource systems in World of Warcraft 11.2, including primary and secondary resources, regeneration mechanics, and special edge cases that must be handled in our template architecture.

## Resource Type Matrix

| Class | Primary Resource | Secondary Resource(s) | Specialization Variations | Complexity |
|-------|-----------------|----------------------|---------------------------|------------|
| **Death Knight** | Runes (6) | Runic Power (0-130) | All specs use both | High - Complex dual system |
| **Demon Hunter** | Fury (Havoc) / Pain (Vengeance) | None | Resource type varies by spec | Medium - Different resources per spec |
| **Druid** | Varies by form | Combo Points (Feral), Astral Power (Balance) | Form-dependent resources | High - Multiple resource types |
| **Evoker** | Mana | Essence (5 charges) | All specs use both | Medium - Charge-based secondary |
| **Hunter** | Focus (0-100) | None | All specs use Focus | Low - Simple regenerating resource |
| **Mage** | Mana | Arcane Charges (Arcane only) | Arcane has charges | Low-Medium |
| **Monk** | Energy (0-100) | Chi (0-6) | All specs use both | Medium - Dual resource system |
| **Paladin** | Mana | Holy Power (0-5) | All specs use Holy Power | Medium - Builder/spender system |
| **Priest** | Mana | Insanity (Shadow only) | Shadow uses Insanity | Medium - Spec-specific secondary |
| **Rogue** | Energy (0-100) | Combo Points (0-7 with talents) | All specs use both | Medium - Classic builder/spender |
| **Shaman** | Mana | Maelstrom (Ele/Enh) | Resto uses only Mana | Medium - Spec-dependent secondary |
| **Warlock** | Mana | Soul Shards (0-5) | All specs use Soul Shards | Medium - Fragment system |
| **Warrior** | Rage (0-100) | None | All specs use Rage | Low - Simple generated resource |

## Detailed Class Resource Analysis

### 1. Death Knight
**Primary Resource**: Runes
- 6 total runes: 2 Blood, 2 Frost, 2 Unholy
- Each rune has 10-second cooldown when consumed
- Death Runes can substitute for any rune type
- Runes regenerate independently

**Secondary Resource**: Runic Power
- Generated by spending runes (10-15 per rune)
- Maximum: 130 (can be increased by talents)
- No natural regeneration
- Decays out of combat (2/sec)

**Special Mechanics**:
- Rune regeneration speed affected by Haste
- Death Rune conversion through certain abilities
- Runic Empowerment procs can reset random runes

### 2. Demon Hunter
**Havoc (DPS)**:
- **Primary**: Fury (0-120)
- Generated by abilities like Demon's Bite
- Spent on Chaos Strike, Eye Beam
- No natural regeneration

**Vengeance (Tank)**:
- **Primary**: Pain (0-100)
- Generated by taking damage and abilities
- Spent on Soul Cleave, Spirit Bomb
- No decay

**Special Mechanics**:
- Metamorphosis increases max Fury/Pain
- Soul Fragments generate resource when consumed
- Different resource types per specialization

### 3. Druid
**Balance**: Mana + Astral Power (0-100)
- Astral Power generated by builders (Wrath, Starfire)
- Spent on Starfall, Starsurge
- No decay

**Feral**: Energy (0-100) + Combo Points (0-5)
- Energy regenerates at 10/sec (modified by Haste)
- Combo Points on target

**Guardian**: Rage (0-100)
- Generated by damage taken and abilities
- Decays out of combat

**Restoration**: Mana only

**Special Mechanics**:
- Form shifting changes resource type
- Cat Form Energy != Rogue Energy (different regen rates)
- Bear Form Rage generation from damage taken

### 4. Evoker
**Primary**: Mana
- Standard mana system

**Secondary**: Essence (5 charges)
- Recharge time: ~5 seconds per charge
- Used for Disintegrate, Fire Breath
- All charges regenerate simultaneously

**Special Mechanics**:
- Hover allows casting while moving
- Empowered spells consume Essence differently
- Deep Breath doesn't consume resources

### 5. Hunter
**Primary**: Focus (0-100)
- Base regeneration: 5/sec
- Modified by Haste
- No decay

**Special Mechanics**:
- Steady Shot/Cobra Shot generate Focus
- Pet Basic Attack generates Focus (Beast Mastery)
- Trueshot increases Focus regeneration

### 6. Mage
**All Specs**: Mana

**Arcane Only**: Arcane Charges (0-4)
- Generated by Arcane Blast, Arcane Missiles
- Increase damage and mana cost
- Consumed by Barrage

**Special Mechanics**:
- Arcane Power doesn't consume charges
- Clearcasting procs make next spell free
- Evocation restores mana over channel

### 7. Monk
**Primary**: Energy (0-100)
- Base regeneration: 10/sec
- Modified by Haste

**Secondary**: Chi (0-6)
- Generated by builders (Tiger Palm, Keg Smash)
- Maximum can be increased to 6 with talents
- No decay

**Special Mechanics**:
- Windwalker Mastery affects ability costs
- Brewmaster uses different builders
- Mistweaver uses Mana instead of Energy

### 8. Paladin
**Primary**: Mana

**Secondary**: Holy Power (0-5)
- Generated by builders (Blade of Justice, Hammer of Wrath)
- Maximum: 5 (3 baseline, +2 from talents)
- No decay

**Special Mechanics**:
- Divine Purpose procs grant free Holy Power spenders
- Wake of Ashes generates 5 Holy Power instantly
- Some abilities refund Holy Power on kill

### 9. Priest
**Holy/Discipline**: Mana only

**Shadow**: Mana + Insanity (0-100)
- Insanity generated by DoTs and Mind Blast
- Drains continuously in Voidform
- Spent on Void Eruption, Devouring Plague

**Special Mechanics**:
- Voidform increases Insanity drain over time
- Power Word: Shield costs percentage of base mana
- Shadow Word: Death refunds on killing blow

### 10. Rogue
**Primary**: Energy (0-100)
- Base regeneration: 10/sec
- Modified by Haste

**Secondary**: Combo Points (0-7)
- Maximum: 5 (up to 7 with Deeper Stratagem)
- On player since Legion (not on target)
- No decay

**Special Mechanics**:
- Thistle Tea instantly restores 100 Energy
- Shadow Dance doesn't affect resources
- Marked for Death grants 5 Combo Points

### 11. Shaman
**Restoration**: Mana only

**Elemental/Enhancement**: Mana + Maelstrom (0-100)
- Maelstrom generated by abilities
- Spent on Earth Shock, Earthquake
- No decay

**Special Mechanics**:
- Maelstrom Weapon stacks (Enhancement) make spells instant
- Elemental Blast doesn't consume Maelstrom
- Stormkeeper makes next spells free

### 12. Warlock
**Primary**: Mana

**Secondary**: Soul Shards (0-5)
- Generated in fragments (0.1-1.0 per ability)
- Maximum: 5 whole shards
- No decay

**Special Mechanics**:
- Soul Shards are fractional internally
- Drain Soul generates shards on kill
- Some abilities have shard refund chance

### 13. Warrior
**Primary**: Rage (0-100)
- Generated by abilities and auto-attacks
- Decays out of combat (1/sec)
- No natural regeneration

**Special Mechanics**:
- Defensive Stance reduces Rage generation
- Ignore Pain consumes percentage of Rage
- Rage generation scales with damage dealt/taken

## Resource Regeneration Formulas

### Base Regeneration Rates (per second)
```
Energy:      10 * (1 + Haste%)
Focus:       5 * (1 + Haste%)
Mana:        2% of max * Spirit modifier
Rage:        0 (generated only)
Fury/Pain:   0 (generated only)
Runic Power: 0 (generated only)
Maelstrom:   0 (generated only)
Insanity:    Variable drain in Voidform
Essence:     0.2 charges/sec (5 sec per charge)
Runes:       0.1 runes/sec (10 sec per rune)
```

### Decay Rates (per second, out of combat)
```
Rage:        1-2 depending on talents
Runic Power: 2
Others:      No decay
```

## Complex Resource Costs

### Fixed vs Variable Costs
- **Fixed**: Most abilities have fixed costs
- **Variable**: Some abilities scale with available resource
- **Percentage**: Shield Wall (Warrior), Power Word: Shield (Priest)
- **Free Casts**: Procs like Clearcasting, Predatory Swiftness

### Special Cost Mechanics
1. **Rage Dump**: Ignore Pain consumes 30-85 Rage
2. **All Chi**: Fists of Fury consumes all Chi for damage
3. **Shard Fragments**: Chaos Bolt costs 2.0 shards, Shadowburn 1.0
4. **Combo Point Scaling**: Finishers scale with CP spent

## Edge Cases and Special Handling

### 1. Resource Overflow Prevention
- Rune Overcapping: Wasted rune regeneration
- Energy Capping: Lost regeneration at 100
- Combo Point Waste: Generating when at max

### 2. Multi-Resource Abilities
- Death Knight: Death Strike (1 Frost + 1 Unholy + 15 RP)
- Demon Hunter: Eye Beam (30 Fury, generates Fury during channel)

### 3. Resource Transformation
- Voidform: Transforms Shadow Priest gameplay
- Metamorphosis: Increases resource maximum
- Incarnation: Changes ability costs

### 4. Conditional Resource Generation
- Killing Blow refunds (Shadow Word: Death)
- Critical Strike generation (Elemental Focus)
- Proc-based generation (Omen of Clarity)

## Special Mechanics by Expansion

### The War Within (11.2) Changes
1. **Hero Talents**: Modify resource generation
   - Deathbringer (DK): Reaper's Mark affects RP generation
   - San'layn (DK): Vampiric Strike changes
   - Pack Leader (Hunter): Pet Focus generation bonuses

2. **Simplified Scaling**: Haste uniformly affects Energy/Focus
3. **Normalized Decay**: Consistent out-of-combat decay rates
4. **Smart Resource Display**: UI shows fractional Soul Shards

## Template Architecture Recommendations

### 1. Base Template Structure
```cpp
template<typename ResourceType>
class CombatSpecializationBase {
    // ResourceType can be:
    // - SimpleResource (uint32 for Mana, Rage, Energy, Focus)
    // - DualResource (Energy + ComboPoints, Mana + HolyPower)
    // - ComplexResource (Runes + RunicPower)
};
```

### 2. Resource Type Definitions
```cpp
// Simple single resource
struct SimpleResource {
    uint32 current;
    uint32 maximum;
    float regenRate;
};

// Dual resource system
struct DualResource {
    SimpleResource primary;
    SimpleResource secondary;
};

// Complex Death Knight system
struct RuneResource {
    std::array<RuneInfo, 6> runes;
    uint32 runicPower;
    uint32 maxRunicPower;
};

// Evoker Essence system
struct EssenceResource {
    uint32 mana;
    uint32 maxMana;
    uint8 essenceCharges;
    uint32 essenceRechargeRemaining[5];
};
```

### 3. Specialization Mapping
```cpp
// Death Knight
using BloodDK = CombatSpecializationBase<RuneResource>;
using FrostDK = CombatSpecializationBase<RuneResource>;
using UnholyDK = CombatSpecializationBase<RuneResource>;

// Demon Hunter
using HavocDH = CombatSpecializationBase<SimpleResource>; // Fury
using VengeanceDH = CombatSpecializationBase<SimpleResource>; // Pain

// Druid (complex due to forms)
using BalanceDruid = CombatSpecializationBase<DualResource>; // Mana + Astral Power
using FeralDruid = CombatSpecializationBase<DualResource>; // Energy + Combo Points
using GuardianDruid = CombatSpecializationBase<SimpleResource>; // Rage
using RestoDruid = CombatSpecializationBase<SimpleResource>; // Mana

// Rogue
using RogueSpec = CombatSpecializationBase<DualResource>; // Energy + Combo Points

// Monk
using MonkSpec = CombatSpecializationBase<DualResource>; // Energy + Chi
```

### 4. Resource Interface Requirements
```cpp
template<typename ResourceType>
class IResourceManager {
    virtual bool HasEnough(const ResourceType& cost) = 0;
    virtual void Consume(const ResourceType& cost) = 0;
    virtual void Generate(const ResourceType& amount) = 0;
    virtual void Regenerate(uint32 diff) = 0;
    virtual ResourceType GetCurrent() = 0;
    virtual float GetPercent() = 0;
};
```

## Implementation Priority

### High Priority (Complex Systems)
1. Death Knight Rune System
2. Druid Form-based Resources
3. Evoker Essence Charges

### Medium Priority (Dual Resources)
4. Rogue Energy + Combo Points
5. Monk Energy + Chi
6. Paladin Mana + Holy Power
7. Warlock Mana + Soul Shards

### Low Priority (Simple Systems)
8. Warrior Rage
9. Hunter Focus
10. Mage Mana (+ Arcane Charges)
11. Priest Mana (+ Insanity for Shadow)
12. Shaman Mana (+ Maelstrom)
13. Demon Hunter Fury/Pain

## Performance Considerations

### Caching Strategy
- Cache resource costs per spell
- Pre-calculate regeneration rates
- Store form-specific resource pointers

### Update Frequency
- Runes: Check every 100ms
- Energy/Focus: Update every 100ms
- Mana: Update every 500ms
- Combo Points: On ability use only

### Memory Optimization
- Use union for form-dependent resources
- Bit flags for rune availability
- Compact resource state storage

## Validation Requirements

### Resource Accuracy
- Regeneration within 1% of retail
- Costs match spell data exactly
- Decay rates match retail behavior

### Edge Case Handling
- Overflow prevention
- Underflow protection
- Form transition resource preservation

### Combat State Tracking
- In/out of combat detection for decay
- Resource snapshot on combat start
- Emergency resource state detection

## Conclusion

The WoW 11.2 resource system requires a flexible template architecture that can handle:
1. Simple single resources (Rage, Focus)
2. Dual resource systems (Energy + Combo Points)
3. Complex multi-part systems (Runes + Runic Power)
4. Charge-based systems (Essence)
5. Form-dependent resources (Druid)

Our template-based approach with specialized resource types will provide the flexibility needed while maintaining performance for bot-scale operations.