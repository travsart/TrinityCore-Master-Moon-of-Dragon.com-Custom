# =====================================================
# MySQL 9.4 CONFIGURATION FOR TRINITYCORE PLAYERBOT
# Target: 5000+ concurrent bots with minimal latency
# =====================================================

[client]
port = 3306
socket = /var/run/mysqld/mysqld.sock
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
prompt = "\\u@\\h [\\d]> "

[mysqld]
# =====================================================
# BASIC SETTINGS
# =====================================================
port = 3306
socket = /var/run/mysqld/mysqld.sock
datadir = /var/lib/mysql
pid-file = /var/run/mysqld/mysqld.pid
user = mysql
bind-address = 127.0.0.1
skip-name-resolve = 1

# Character set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init-connect = 'SET NAMES utf8mb4'

# =====================================================
# CONNECTION POOL OPTIMIZATION
# =====================================================
# Support 5000+ bot connections
max_connections = 10000
max_user_connections = 5000

# Thread handling for high concurrency
thread_handling = pool-of-threads
thread_pool_size = 16
thread_pool_max_threads = 1000
thread_pool_stall_limit = 60
thread_pool_idle_timeout = 60

# Connection thread caching
thread_cache_size = 500
back_log = 500
max_connect_errors = 1000000

# Network buffer sizes
net_buffer_length = 32K
max_allowed_packet = 256M
net_read_timeout = 30
net_write_timeout = 30
interactive_timeout = 28800
wait_timeout = 28800

# =====================================================
# INNODB OPTIMIZATION (PRIMARY ENGINE)
# =====================================================

# Buffer pool (70% of RAM for dedicated server, adjust for your system)
# For 32GB RAM system, use 22GB
innodb_buffer_pool_size = 22G
innodb_buffer_pool_instances = 16
innodb_buffer_pool_chunk_size = 128M

# Log files for write performance
innodb_log_file_size = 2G
innodb_log_files_in_group = 3
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_flush_log_at_timeout = 1

# I/O optimization
innodb_io_capacity = 4000
innodb_io_capacity_max = 8000
innodb_read_io_threads = 16
innodb_write_io_threads = 16
innodb_purge_threads = 4
innodb_flush_neighbors = 0

# File handling
innodb_file_per_table = 1
innodb_open_files = 8000
innodb_autoinc_lock_mode = 2

# Concurrency settings
innodb_thread_concurrency = 0
innodb_concurrency_tickets = 5000
innodb_lock_wait_timeout = 50
innodb_deadlock_detect = ON

# Change buffer for secondary indexes
innodb_change_buffer_max_size = 30
innodb_change_buffering = all

# Adaptive features
innodb_adaptive_hash_index = ON
innodb_adaptive_hash_index_parts = 32
innodb_adaptive_flushing = ON
innodb_adaptive_flushing_lwm = 10

# Compression
innodb_compression_level = 6
innodb_compression_failure_threshold_pct = 10
innodb_compression_pad_pct_max = 50

# Performance schema specific
innodb_monitor_enable = all
innodb_print_all_deadlocks = ON
innodb_status_output = OFF
innodb_status_output_locks = OFF

# Page cleaners for write performance
innodb_page_cleaners = 8
innodb_max_dirty_pages_pct = 75
innodb_max_dirty_pages_pct_lwm = 10

# Undo tablespace
innodb_undo_tablespaces = 4
innodb_undo_log_truncate = ON
innodb_max_undo_log_size = 1G
innodb_undo_log_encrypt = OFF

# Parallel operations
innodb_parallel_read_threads = 8
innodb_ddl_threads = 4
innodb_ddl_buffer_size = 1M

# =====================================================
# MEMORY ENGINE OPTIMIZATION (FOR CACHE TABLES)
# =====================================================
max_heap_table_size = 2G
tmp_table_size = 2G

# =====================================================
# QUERY CACHE (Disabled in MySQL 8.0+, using alternative caching)
# =====================================================
# Using alternative caching strategies instead

# =====================================================
# TABLE AND INDEX OPTIMIZATION
# =====================================================
table_open_cache = 8000
table_open_cache_instances = 16
table_definition_cache = 4000
metadata_locks_cache_size = 1024
metadata_locks_hash_instances = 64

# =====================================================
# QUERY OPTIMIZATION
# =====================================================
# Join buffers
join_buffer_size = 8M
sort_buffer_size = 8M
read_buffer_size = 4M
read_rnd_buffer_size = 8M

# Group by optimization
group_concat_max_len = 1048576
max_length_for_sort_data = 4096

# Optimizer settings
optimizer_prune_level = 1
optimizer_search_depth = 62
optimizer_switch = 'index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,index_merge_sort_intersection=off,index_condition_pushdown=on,derived_merge=on,derived_with_keys=on,firstmatch=on,loosescan=on,materialization=on,semijoin=on,duplicateweedout=on,subquery_materialization_cost_based=on,use_index_extensions=on,condition_fanout_filter=on,derived_condition_pushdown=on,hash_join=on'

# Range optimization
range_optimizer_max_mem_size = 8M
range_alloc_block_size = 4K

# =====================================================
# PREPARED STATEMENTS
# =====================================================
max_prepared_stmt_count = 500000

# =====================================================
# BINARY LOGGING (for replication/backup)
# =====================================================
server-id = 1
log_bin = mysql-bin
binlog_format = ROW
binlog_row_image = MINIMAL
expire_logs_days = 7
max_binlog_size = 1G
binlog_cache_size = 4M
binlog_stmt_cache_size = 4M
sync_binlog = 100

# =====================================================
# SLOW QUERY LOG
# =====================================================
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 0.01
log_queries_not_using_indexes = 1
log_throttle_queries_not_using_indexes = 10
min_examined_row_limit = 100

# =====================================================
# ERROR LOGGING
# =====================================================
log_error = /var/log/mysql/error.log
log_error_verbosity = 2
log_timestamps = SYSTEM

# =====================================================
# PERFORMANCE SCHEMA
# =====================================================
performance_schema = ON
performance_schema_max_table_instances = 12500
performance_schema_max_table_handles = 50000
performance_schema_max_thread_instances = 10000
performance_schema_max_thread_classes = 100

# Monitor specific instruments for bot performance
performance-schema-instrument = 'memory/%=ON'
performance-schema-instrument = 'stage/%=ON'
performance-schema-instrument = 'statement/%=ON'
performance-schema-instrument = 'transaction=%=ON'
performance-schema-instrument = 'wait/io/file/%=ON'
performance-schema-instrument = 'wait/lock/table/%=ON'

# =====================================================
# REPLICATION (for read replicas)
# =====================================================
# Master configuration
gtid_mode = ON
enforce_gtid_consistency = ON
binlog_gtid_simple_recovery = 1
replica_parallel_workers = 16
replica_parallel_type = LOGICAL_CLOCK
replica_preserve_commit_order = 1

# =====================================================
# SECURITY
# =====================================================
local_infile = 0
skip_symbolic_links = 1
secure_file_priv = /var/lib/mysql-files
default_authentication_plugin = caching_sha2_password

# =====================================================
# WINDOWS SPECIFIC (if running on Windows)
# =====================================================
# Uncomment these if running on Windows
# named_pipe = OFF
# shared_memory = OFF
# shared_memory_base_name = MYSQL

# =====================================================
# OPTIMIZER HINTS FOR PLAYERBOT QUERIES
# =====================================================
# These can be set at session level for bot connections
# SET SESSION optimizer_use_condition_selectivity = 4;
# SET SESSION optimizer_trace = "enabled=on";
# SET SESSION optimizer_trace_max_mem_size = 1048576;

[mysqldump]
quick
quote-names
max_allowed_packet = 256M
single-transaction
routines
triggers
events

[isamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 8M
write_buffer = 8M

[myisamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 8M
write_buffer = 8M

[mysqlhotcopy]
interactive-timeout

# =====================================================
# PERFORMANCE TUNING SUMMARY
# =====================================================
# Key optimizations for PlayerBot:
# 1. Connection pool: 10000 max connections with thread pooling
# 2. InnoDB buffer pool: 22GB (adjust based on RAM)
# 3. Thread cache: 500 threads cached
# 4. Table cache: 8000 tables with 16 instances
# 5. Prepared statements: 500k max for bot queries
# 6. I/O threads: 16 read, 16 write
# 7. Memory tables: 2GB for session cache
# 8. Slow query log: 10ms threshold
#
# Expected improvements:
# - Connection time: <1ms
# - Query cache hit: >90%
# - Thread cache hit: >95%
# - Table cache hit: >99%
# - Bot login: <100ms
# - Concurrent bots: 5000+
# =====================================================